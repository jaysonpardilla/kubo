
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refreshify Navbar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>
        /* make icon and label closer */
        .nav-icon { display: block; margin: 0 auto; margin-bottom: 4px; }
        .nav-label { font-size: 0.75rem; margin-top: 0; line-height: 1; }
        .nav-tile { display: inline-block; padding: 0 6px; }
    </style>
</head>  
<body>
    <nav class="navbar navbar-expand-lg px-5 shadow-sm" style="background-color: #FFF8E7; position: sticky; top: 0; z-index: 1030;">
        <div class="container-fluid">
            <!-- Logo -->
            {% if request.user.business %}
                <a class="navbar-brand d-flex align-items-center" href="{% url 'manage_business:home' %}">
                    <img src="../../../static/icons/logo1.png" alt="Refreshify Logo" width="50" height="50">
                    <h3 class="ms-2 mb-0 fw-bold text-dark" style="font-family: 'Itim', cursive;">E-Kubo</h3>
                </a>
            {% else %}
                <a class="navbar-brand d-flex align-items-center" href="{% url 'chat:home' %}">
                    <img src="../../../static/icons/logo1.png" alt="Refreshify Logo" width="50" height="50">
                    <h3 class="ms-2 mb-0 fw-bold text-dark" style="font-family: 'Itim', cursive;">E-Kubo</h3>
                </a>
            {% endif %}

            <!-- Toggle Button for Mobile -->
            <button class="navbar-toggler" type="button" id="navbar-toggler">
                <span class="navbar-toggler-icon"></span>
            </button>
    
            <!-- Navbar Items -->
            <div class="collapse navbar-collapse" id="navbarNav">
                {% if user.is_authenticated %}
                <ul class="navbar-nav ms-auto align-items-center pl-3">
                    {% if request.user.business %}
                        <li class="nav-item d-flex align-items-center me-3" style="font-family: 'Arial', sans-serif;">
                        <div class="d-flex align-items-center" style="gap:22px;"> 
                            <div class="text-center">
                                <a href="{% url 'products:add_new_products' %}" class="nav-link p-0 nav-tile">
                                    <i class="bi bi-plus-square fs-4 nav-icon"></i>
                                    <div class="small nav-label">New Product</div>
                                </a>
                            </div>
                            <div class="text-center">
                                <a href="{% url 'products:add_category' %}" class="nav-link p-0 nav-tile">
                                    <i class="bi bi-tags fs-4 nav-icon"></i>
                                    <div class="small nav-label">New Category</div>
                                </a>
                            </div>
                        </div>
                    </li>
                    {% else %}
                        <form method="GET" action="{% url 'chat:home' %}" class="d-flex ms-3" style="margin-right: 20px;">
                            <input class="form-control" type="search" name="q" placeholder="Search for products..." aria-label="Search"
                                style="height: 44px; width: 450px; background-color: #F0F0F081; border: 1px solid #A4A584; border-radius: 8px; font-family: Arial, sans-serif;">
                            <button class="btn btn-outline-success" type="submit" style="height: 44px; font-family: Arial, sans-serif;"><i class="fas fa-search"></i></button>
                        </form>

                    <li class="nav-item d-flex align-items-center me-3" style="font-family: 'Arial', sans-serif;">
                        <div class="d-flex align-items-center" style="gap:22px;"> 
                            <div class="text-center">
                                <a class="nav-link p-0 nav-tile" href="{% url 'chat:home' %}">
                                    <i class="bi bi-house fs-4 nav-icon"></i>
                                    <div class="small nav-label">Home</div>
                                </a>
                            </div>
                            <div class="text-center">
                                    <a class="nav-link p-0 nav-tile" href="{% url 'shops:shops_list' %}">
                                        <i class="bi bi-shop fs-4 nav-icon"></i>
                                        <div class="small nav-label">Shop</div>
                                    </a>
                            </div>
                            <div class="text-center">
                                <a class="nav-link p-0 nav-tile" href="{% url 'products:submit_report' %}">
                                    <i class="bi bi-question-circle fs-4 nav-icon"></i>
                                    <div class="small nav-label">Help</div>
                                </a>
                            </div>
                        </div>
                    </li>
                    {% endif %}

                    <!-- Notification --> 
                    <li class="nav-item text-center me-3" style="margin-left: 40px;">
                        <a class="nav-link position-relative" href="{% url 'chat:buyer_notification' %}" id="notification-link">
                            <img src="../../../static/icons/not.png" width="28" height="28" alt="Notifications" class="nav-icon">
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notification-count">0</span>
                            <div class="small nav-label">Notifs</div>
                        </a>
                    </li>

                    <!-- Messages -->
                    <li class="nav-item text-center me-3">
                        <a class="nav-link position-relative" href="{% url 'chat:chat_dashboard' %}" id="message-link">
                            <i class="bi bi-chat-dots fs-4 nav-icon"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="message-count">0</span>
                            <div class="small nav-label">Chats</div>
                        </a>
                    </li>
    
                    <!-- Profile -->
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'chat:profile_detail' %}">
                            {% if request.user.profile.profile %}
                                <img src="{{ request.user.profile.profile.url }}" alt="Profile" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #729FF1;">
                            {% else %}
                                <i class="bi bi-person-circle fs-4"></i>
                            {% endif %}
                        </a>
                    </li>
                </ul>
                {% else %}
                <div class="d-flex w-100 justify-content-center align-items-center" style="font-family: 'Arial', sans-serif;"> 
                    <form method="GET" action="{% url 'chat:landing_page' %}" class="d-flex ms-3">
                        <input id="landing-search" class="form-control searchh" type="search" name="q" placeholder="Search for products..." aria-label="Search">
                        <button class="btn btn-success" type="submit" style="height: 40px;"><i class="fas fa-search"></i></button>
                    </form>
                    <div class="ms-auto ">
                        <a href="{% url 'chat:login' %}">
                            <button style="border-radius: 20px; padding: 5px; padding-left: 10px; padding-right: 10px;" type="submit">Sign in</button>
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>
    

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const navbarToggler = document.getElementById("navbar-toggler");
            const navbarNav = document.getElementById("navbarNav");

            navbarToggler.addEventListener("click", function () {
                navbarNav.classList.toggle("show");
            });

            // Close navbar when clicking outside
            document.addEventListener("click", function (event) {
                if (!navbarNav.contains(event.target) && !navbarToggler.contains(event.target)) {
                    navbarNav.classList.remove("show");
                }
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            const sidebar = document.getElementById("sidebar");
            const overlay = document.getElementById("overlay");
            const menuToggle = document.getElementById("menu-toggle");
            menuToggle.addEventListener("click", function () {
                sidebar.classList.add("active");
                overlay.classList.add("active");
            });
            overlay.addEventListener("click", function () {
                sidebar.classList.remove("active");
                overlay.classList.remove("active");
            });
        });


        document.addEventListener("DOMContentLoaded", function () {
            const notificationCountElement = document.getElementById("notification-count");
            const notificationLink = document.getElementById("notification-link");

            function fetchNotifications() {
                fetch("{% url 'chat:get_notifications' %}") 
                    .then(response => response.json())
                    .then(data => {
                        if (data.count > 0) {
                            notificationCountElement.textContent = data.count;
                        } else {
                            notificationCountElement.textContent = "";
                        }
                    });
            }

            notificationLink.addEventListener("click", function () {
                fetch("{% url 'chat:mark_notifications_read' %}", {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": getCSRFToken(),
                        "X-Requested-With": "XMLHttpRequest",
                    },
                }).then(() => {
                    notificationCountElement.textContent = "";
                });
            });

            function getCSRFToken() {
                    return document.querySelector("[name=csrfmiddlewaretoken]").value;
                }

                fetchNotifications();  // Load notifications on page load
                setInterval(fetchNotifications, 10000);  // Fetch every 10 seconds
            });




            //for tracking if there is new message in messenger
            document.addEventListener("DOMContentLoaded", function () {
        const messageCountElement = document.getElementById("message-count");
        const messageLink = document.getElementById("message-link");

        function fetchUnreadMessages() {
            fetch("{% url 'chat:get_unread_messages' %}") // Update with your actual URL name
                .then(response => response.json())
                .then(data => {
                    if (data.count > 0) {
                        messageCountElement.textContent = data.count;
                    } else {
                        messageCountElement.textContent = "";
                    }
                });
        }

        messageLink.addEventListener("click", function () {
            fetch("{% url 'chat:mark_messages_read' %}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": getCSRFToken(),
                    "X-Requested-With": "XMLHttpRequest",
                },
            }).then(() => {
                messageCountElement.textContent = "";
            });
        });

        function getCSRFToken() {
            return document.querySelector("[name=csrfmiddlewaretoken]").value;
        }

        fetchUnreadMessages();  // Load unread messages count on page load
        setInterval(fetchUnreadMessages, 10000);  // Fetch every 10 seconds
    });

    </script>
    <!-- Bootstrap 5 CSS -->
    <!-- Bootstrap 5 JS (Requires Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/libs/simplebar/dist/simplebar.min.js"></script>
    <script src="../assets/js/vendors/jquery.min.js"></script>
    <script src="../assets/libs/slick-carousel/slick/slick.min.js"></script>
    <script src="../assets/js/vendors/slick-slider.js"></script>
    <script src="../assets/libs/tiny-slider/dist/min/tiny-slider.js"></script>
    <script src="../assets/js/vendors/tns-slider.js"></script>
</body>
</html>
